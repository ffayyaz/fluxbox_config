#!/bin/sh
#
# fluxbox startup-script:
#
# Lines starting with a '#' are ignored.

# set black background forcibly (maybe overlay is not needed anymore)
/usr/bin/fbsetroot -solid black

# or set a background image
#fbsetbg -f /path/to/image.jpg

# show fluxbox splash screen
#fbsetbg -C /usr/share/fluxbox/splash.jpg

# turn off beeps
xset b off

# own font path
# xset +fp "~/.fonts"

# Change your keymap:
#xmodmap "~/.Xmodmap" # TODO check this
[ -f /usr/bin/setxkbmap ] && /usr/bin/setxkbmap ch

# Applications you want to run with fluxbox.
# MAKE SURE THAT APPS THAT KEEP RUNNING HAVE AN ''&'' AT THE END.
#
[ -x /usr/bin/gkrellm ] && gkrellm -w &
[ -x /usr/bin/wmmoonclock ] && wmmoonclock &

################### PROGRAMS ###################################################


################### GUI APPLICATIONS ###########################################
# NOTE: gui apps need to be started delayed
#       otherwise all windows are messed up 

fluxbox &
fbpid=$!

sleep 4
{
	#source /home/fafa/.bashrc
	#truecrypt /data/bizz
	#lan
	#/sbin/ifconfig|egrep '192.1'
	#if [ ${?} -ne 0 ]; then
	#	dhclient eth0
	#fi
	
	#_______ Autostart everywhere ______________________________________________
	
	# visual effects
	# TODO check this in general
	if [ -x /usr/bin/xcompmgr ]; then
	    # xcompmgr -c &
	    xcompmgr -cC -fF -r6 -l-6 -t-6 -I-0.004 -O-0.004 -D1.95&
	fi

    # eye candies
	#[ -x /usr/bin/xfishtank ] && xfishtank &
	#[ -x /usr/bin/xdesktopwaves ] && xdesktopwaves -c 5 -vs 5 -li 9 -nwm -si 4 -lal 50 -laz 0 -fr 75 -sf 2 &
	#[ -x /usr/bin/xsnow ] && xsnow -snowflakes 25 -windtimer 20 -nosanta -notrees -nokeepsnowonscreen -sc darkred -whirl 1 -xspeed 4 -yspeed 7 -wsnowdepth 25 &
	#[ -x /usr/bin/xsnow ] && xsnow -snowflakes 350 -windtimer 20 -nosanta -notrees -nokeepsnowonscreen -nokeepsnowonwindows -sc darkcyan -whirl 1 -xspeed 4 -yspeed 7 &
	
	# tools / gadgets 
# 	[ -x /usr/sbin/thinkfan ] && sudo thinkfan -n&
	[ -x /usr/bin/unclutter ] && unclutter -idle 2 &
	[ -x /usr/bin/xscreensaver ] && xscreensaver -no-splash&
	[ -x /usr/bin/gdeskcal ] && gdeskcal & 
	[ -x /usr/bin/xclock ] && xclock -analog -twentyfour -update 1 -padding 1 -render -sharp&
	[ -x /usr/bin/wmmixer ] && wmmixer &
	# TODO mail watcher
	# TODO rss reader (liferea, yarssr
	[ -x /usr/bin/liferea ] && liferea &
	# TODO notes
	[ -x /usr/bin/xpad ] && xpad &

    # gui applications
    [ -x /usr/bin/skype ] && skype &
    if [ -x /usr/bin/chromium ]; then
        # chromium &
        chromium www.google.ch&
        rsync -arptl --delete-before --exclude "*Session*" /home/fafa/.config/chromium/ /home/fafa/.config/chromiumnews/
        rsync -arptl --delete-before --exclude "*Session*" /home/fafa/.config/chromium/ /home/fafa/.config/chromiummusic/
        rsync -arptl --delete-before --exclude "*Session*" /home/fafa/.config/chromium/ /home/fafa/.config/chromiumheise/
	    chromium --user-data-dir=/home/fafa/.config/chromiummusic www.soundcloud.com&
    fi

    [ -x /usr/bin/audacious ] && audacious &

    #_______ Autostart Home only _______________________________________________
    /sbin/ifconfig|egrep '192.168.85.(10|14|21|22)'
    if [ "${?}" = "0" ]; then
        [ -x /usr/bin/icedove ] && icedove &
        # [ -x /usr/bin/kate ] && kate /tmp/notesx.y.z.txt &
        if [ -x /usr/bin/chromium ]; then
		    chromium --user-data-dir=/home/fafa/.config/chromiumnews www.nzz.ch www.tagi.ch www.20min.ch www.blick.ch&
		    chromium --user-data-dir=/home/fafa/.config/chromiumheise www.heise.de&
        fi
    fi

    #_______ Autostart Ganja only ______________________________________________
    /sbin/ifconfig|egrep '192.168.85.10'
    if [ "${?}" = "0" ]; then
	    [ -x /usr/bin/xchat ] && xchat &
    fi

    #_______ Autostart Netstream only __________________________________________
    /sbin/ifconfig|egrep '192.168.1.116'
    if [ "${?}" = "0" ]; then
        [ -x /usr/bin/virtualbox ] && virtualbox &
        # [ -x /usr/bin/kate ] && kate ~/stuff/notes/notes_`date +"%Y-%m-%d"`.txt&
	    if [ -x /usr/bin/chromium ]; then
            chromium intranet.netstream.ch& # TODO add rest
	    fi
    fi

    #_______ Autostart mobile only _____________________________________________
    if [ "`hostname`" = "mobile" ]; then
        cpufreqterm &
    fi

    #_______ Autostart everywhere (final)_______________________________________

    urxvt &

    # they need to be started at the end, otherwise 
    # they are not drawn correctly (they overlap the slit)
    # BULLCRAP workaround
    # maybe this problem is solved using the sleep solution to start fluxbox
    messagesterm &
    syslogterm &
    debuglogterm &
    dmesglogterm &
    authlogterm &
    kernlogterm &
    diskusageterm &

    #
    # Debian-local change:
    #   - fbautostart has been added with a quick hack to check to see if it
    #     exists. If it does, we'll start it up by default.
    which fbautostart > /dev/null
    if [ $? -eq 0 ]; then
        fbautostart
    fi
} &
 
wait $fbpid


# END AUTOSTART -----------------------------------------------------------


# And last but not least we start fluxbox.
# Because it is the last app you have to run it with ''exec'' before it.

#exec fluxbox
# or if you want to keep a log:
# exec fluxbox -log "/home/fafa/.fluxbox/log"
